<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="manifest" href="manifest.json">
  <title>Fb2 Reader</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
      font-family: system-ui, -apple-system, sans-serif; 
      background-color: #000;
      color: #fff;
      margin: 20px;
      text-align: center;
    }

    h1 {
      color: #fff;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫: —Ä–∞–∑–º–µ—â–∞–µ—Ç –∏—Ö –ø–æ –∫—Ä–∞—è–º */
    #controls {
      display: flex;
      justify-content: space-between; 
      align-items: center;
      margin: 0 0 20px 0; 
    }

    /* –û–±—â–∏–π —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    #loadFileButton, #changeFontButton {
      padding: 10px 20px;
      font-family: 'Ubuntu', sans-serif;
      font-size: 16px;
      font-weight: bold;
      border-radius: 0px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      border: none; 
      /* üî¥ –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –®–ò–†–ò–ù–ê –î–õ–Ø –ï–î–ò–ù–û–û–ë–†–ê–ó–ò–Ø */
      width: 120px; 
      text-align: center; 
    }

    /* üü° –ö–Ω–æ–ø–∫–∞ Menu: –ñ–µ–ª—Ç—ã–π —Ñ–æ–Ω, –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π —Ç–µ–∫—Å—Ç */
    #loadFileButton {
      background-color: #ffd700; 
      color: #000080; 
    }

    /* üîµ –ö–Ω–æ–ø–∫–∞ Font (–±—ã–≤—à–∞—è Change font): –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω, –ñ–µ–ª—Ç—ã–π —Ç–µ–∫—Å—Ç */
    #changeFontButton {
      background-color: #000080; 
      color: #ffd700; 
    }

    /* –°—Ç–∏–ª–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (Hover) */
    #loadFileButton:hover {
      background-color: #ffa500; 
    }

    #changeFontButton:hover {
      background-color: #191970; 
    }

    #loadFileButton:active, #changeFontButton:active {
      transform: scale(0.95);
    }

    #fileInput {
      display: none; 
    }
    
    /* –ù–û–í–û–ï –ú–ï–ù–Æ –°–õ–ï–í–ê (#leftMenuSelectMenu) */
    #leftMenuSelectMenu {
        position: absolute;
        top: 60px; 
        left: 20px; 
        background-color: #222;
        border: 1px solid #ffd700; 
        padding: 5px;
        z-index: 100; 
        display: flex;
        flex-direction: column;
    }

    #leftMenuSelectMenu button {
        background: none;
        color: #ddd;
        border: none;
        font-size: 1.1em; 
        padding: 5px 10px;
        width: 100%; 
        text-align: left; 
        cursor: pointer;
    }

    #leftMenuSelectMenu button:hover {
        background-color: #ffd700;
        color: #000;
    }

    /* –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —à—Ä–∏—Ñ—Ç–æ–≤ (–°–ü–†–ê–í–ê) */
    #fontSelectMenu {
        position: absolute;
        top: 60px; 
        right: 20px;
        background-color: #222;
        border: 1px solid #ffd700; 
        padding: 5px;
        z-index: 100; 
        display: flex;
        flex-direction: column;
    }

    #fontSelectMenu button {
        background: none;
        color: #ddd;
        border: none;
        font-size: 1.1em; 
        padding: 5px 10px;
        width: 100%; 
        text-align: right; 
        cursor: pointer;
    }

    #fontSelectMenu button:hover {
        background-color: #ffd700;
        color: #000;
    }


    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –∫–Ω–∏–≥–∏ */
    .title {
      font-size: 1.5em;
      font-weight: bold;
      margin: 10px 0;
    }

    .author {
      font-size: 1em;
      color: #ccc;
    }

    .section-title {
      font-size: 1.2em;
      margin-top: 20px;
      color: #ffd700;
    }

    .paragraph {
      margin: 10px 0;
      line-height: 1.6;
      color: #ddd;
    }
  </style>
</head>
<body>
  
  <div id="controls">
    <button id="loadFileButton">Menu</button> 
    <button id="changeFontButton">Font</button>
  </div>
  
  <input type="file" id="fileInput" accept=".fb2">

  <div id="leftMenuSelectMenu" style="display: none;">
    <button id="loadBookMenuItem">Load book</button>
    <button id="helpMenuItem">Help</button>
  </div>

  <div id="fontSelectMenu" style="display: none;">
    <button data-font="Courier New">Courier</button>
    <button data-font="Ubuntu">Ubuntu</button>
    <button data-font="San Francisco">System</button>
  </div>
  
  <div id="content" style="margin-top: 20px;"></div>

  <script>
    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const loadFileButton = document.getElementById('loadFileButton');
    const fileInput = document.getElementById('fileInput');
    const changeFontButton = document.getElementById('changeFontButton');
    const fontSelectMenu = document.getElementById('fontSelectMenu');
    const contentDiv = document.getElementById('content');
    
    const leftMenuSelectMenu = document.getElementById('leftMenuSelectMenu');
    const loadBookMenuItem = document.getElementById('loadBookMenuItem');
    const helpMenuItem = document.getElementById('helpMenuItem');
    

    // –§–£–ù–ö–¶–ò–Ø: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —à–∏—Ä–∏–Ω—ã –æ–±–æ–∏—Ö –º–µ–Ω—é –ø–æ —à–∏—Ä–∏–Ω–µ –∏—Ö –∫–Ω–æ–ø–æ–∫ (—à–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–æ–∫ —Ç–µ–ø–µ—Ä—å –æ–¥–∏–Ω–∞–∫–æ–≤–∞ = 120px)
    function setMenuWidth() {
      // –®–∏—Ä–∏–Ω–∞ –õ–µ–≤–æ–≥–æ –ú–µ–Ω—é = –®–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–∫–∏ Menu
      const leftButtonWidth = loadFileButton.offsetWidth; 
      leftMenuSelectMenu.style.width = leftButtonWidth + 'px';

      // –®–∏—Ä–∏–Ω–∞ –ü—Ä–∞–≤–æ–≥–æ –ú–µ–Ω—é = –®–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–∫–∏ Font
      const rightButtonWidth = changeFontButton.offsetWidth; 
      fontSelectMenu.style.width = rightButtonWidth + 'px';
    }

    // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    document.addEventListener('DOMContentLoaded', setMenuWidth);
    window.addEventListener('resize', setMenuWidth);
    
    // 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "Menu" (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–µ–≤–æ–µ –º–µ–Ω—é)
    loadFileButton.addEventListener('click', (event) => {
      event.stopPropagation();
      leftMenuSelectMenu.style.display = leftMenuSelectMenu.style.display === 'block' ? 'none' : 'block';
      fontSelectMenu.style.display = 'none';
    });

    // 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "Font" (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–æ–µ –º–µ–Ω—é)
    changeFontButton.addEventListener('click', (event) => {
      event.stopPropagation();
      fontSelectMenu.style.display = fontSelectMenu.style.display === 'block' ? 'none' : 'block';
      leftMenuSelectMenu.style.display = 'none';
    });
    
    // 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –õ–µ–≤–æ–≥–æ –ú–µ–Ω—é
    loadBookMenuItem.addEventListener('click', () => {
        fileInput.click(); 
        leftMenuSelectMenu.style.display = 'none';
    });

    helpMenuItem.addEventListener('click', () => {
        window.open('https://eqlectika.t.me', '_blank'); 
        leftMenuSelectMenu.style.display = 'none';
    });
    
    // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    fileInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const parser = new DOMParser();
          const xmlDoc = parser.parseFromString(e.target.result, "application/xml");
          contentDiv.innerHTML = ""; 

          const titleInfo = xmlDoc.querySelector("description > title-info");
          if (titleInfo) {
            const bookTitle = titleInfo.querySelector("book-title")?.textContent || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
            const authorFirstName = titleInfo.querySelector("author > first-name")?.textContent || "";
            const authorLastName = titleInfo.querySelector("author > last-name")?.textContent || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–≤—Ç–æ—Ä";
            const author = `${authorFirstName} ${authorLastName}`.trim();
            contentDiv.innerHTML += `<div class="title">${bookTitle}</div>`;
            contentDiv.innerHTML += `<div class="author">–ê–≤—Ç–æ—Ä: ${author}</div>`;
          }

          const body = xmlDoc.querySelector("body");
          if (body) {
            body.querySelectorAll("section").forEach(section => {
              const sectionTitle = section.querySelector("title > p")?.textContent;
              if (sectionTitle) {
                contentDiv.innerHTML += `<div class="section-title">${sectionTitle}</div>`;
              }

              section.querySelectorAll("p").forEach(paragraph => {
                contentDiv.innerHTML += `<div class="paragraph">${paragraph.textContent}</div>`;
              });
            });
          } else {
            contentDiv.innerHTML = "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–Ω–∏–≥–∏.";
          }
        };

        reader.readAsText(file); 
      } else {
        alert("–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω!");
      }
    });

    // 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    fontSelectMenu.querySelectorAll('button').forEach(button => {
      button.addEventListener('click', function() {
        const selectedFont = this.getAttribute('data-font');
        let fontCSS;

        if (selectedFont === 'Ubuntu') {
          fontCSS = "'Ubuntu', sans-serif";
        } else if (selectedFont === 'San Francisco') {
          fontCSS = 'system-ui, -apple-system, sans-serif';
        } else {
          fontCSS = "'Courier New', monospace";
        }

        document.body.style.fontFamily = fontCSS;
        fontSelectMenu.style.display = 'none';
      });
    });

    // 6. –°–∫—Ä—ã–≤–∞–µ–º –æ–±–∞ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –Ω–∏—Ö
    document.addEventListener('click', function(event) {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–∫–∞ –¥–ª—è –õ–µ–≤–æ–≥–æ –ú–µ–Ω—é
        if (!leftMenuSelectMenu.contains(event.target) && !loadFileButton.contains(event.target)) {
            leftMenuSelectMenu.style.display = 'none';
        }
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–∫–∞ –¥–ª—è –ü—Ä–∞–≤–æ–≥–æ –ú–µ–Ω—é
        if (!fontSelectMenu.contains(event.target) && !changeFontButton.contains(event.target)) {
            fontSelectMenu.style.display = 'none';
        }
    });

  </script>
</body>
</html>
