<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">    
  <title>Анимация траектории Меркурия относительно Земли</title>
  <style>
    body {
      text-align: center;
      font-family: monospace;
      background-color: #000000;
    }
    canvas {
      background-color: #000000;
      border: 0px solid #ccc;
      margin-top: 20px;
    }
    h1 {
color: #ffffff;
      margin-top: 20px;
    }
    #controls {

color: #ffffff;

      margin-top: 10px;
    }
    label {
      font-size: 16px;
      cursor: pointer;
      user-select: none;
    }
    img {
  max-width: 100%;
  height: auto;
}

@media (max-width: 600px) {
  img {
    width: 90vw; /* 90% ширины экрана */
    height: auto;
  }
}

  </style>
</head>
<body>
  <h1>Анимация траектории Меркурия относительно Земли</h1>

  <div id="controls">
    <label>
      <input type="radio" name="speed" value="4.15" checked>
      Точное значение (4.15 оборота)
    </label>
    &nbsp;&nbsp;&nbsp;
    <label>
      <input type="radio" name="speed" value="4.00">
      Упрощённое (4.00 оборота)
    </label>
  </div>

  <canvas id="orbitCanvas" width="600" height="600"></canvas>

  <script>
    const canvas = document.getElementById('orbitCanvas');
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const centerX = width / 2;
    const centerY = height / 2;

    // Радиус орбиты Земли в пикселях
    const R_E = 200;
    const R_M = R_E * 0.387;

    // Угловая скорость Земли (рад/день)
    const omega_E = 2 * Math.PI / 365;

    // Параметры анимации
    let t = 0;          // Время в днях
    const dt = 0.5;     // Шаг времени (дней) для анимации

    // Текущая угловая скорость Меркурия (будет меняться)
    let omega_M;

    // Получить выбранное значение скорости Меркурия
    function updateOmegaM() {
      const radios = document.getElementsByName('speed');
      let ratio = 4.15; // по умолчанию
      for (const r of radios) {
        if (r.checked) {
          ratio = parseFloat(r.value);
          break;
        }
      }
      // omega_M = ratio * omega_E (поскольку omega_E = 2π/365)
      omega_M = ratio * omega_E;
    }

    // Нарисовать орбиты Земли и Меркурия (круги)
    function drawOrbits() {
      ctx.strokeStyle = '#cccccc';
      ctx.lineWidth = 1;

      // Орбита Земли (центр в центре холста)
      ctx.beginPath();
      ctx.arc(centerX, centerY, R_E, 0, 2 * Math.PI);
      ctx.stroke();

      // Орбита Меркурия (центр в центре холста)
      ctx.beginPath();
      ctx.arc(centerX, centerY, R_M, 0, 2 * Math.PI);
      ctx.stroke();
    }

    // Нарисовать планету (круг)
    function drawPlanet(x, y, radius, color, label) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(x, y, radius, 0, 2 * Math.PI);
      ctx.fill();

      if (label) {
        ctx.fillStyle = 'black';
        ctx.font = '14px Arial';
        ctx.fillText(label, x + radius + 5, y);
      }
    }

    // Хранить точки траектории Меркурия относительно Земли для рисования линии
    let trajectoryPoints = [];

    // Максимальное число точек для траектории (чтобы не перегружать память)
    const maxPoints = 3000;

    // Очистить холст
    function clearCanvas() {
      ctx.fillStyle = '#000000';
      ctx.fillRect(0, 0, width, height);
    }

    // Основная функция анимации
    function animate() {
      clearCanvas();

      drawOrbits();

      // Позиция Земли
      const xE = centerX + R_E * Math.cos(omega_E * t);
      const yE = centerY + R_E * Math.sin(omega_E * t);

      // Позиция Меркурия
      const xM = centerX + R_M * Math.cos(omega_M * t);
      const yM = centerY + R_M * Math.sin(omega_M * t);

      // Позиция Меркурия относительно Земли (в координатах холста)
      const xRel = xM - xE;
      const yRel = yM - yE;

      // Добавляем точку в траекторию (относительно центра холста)
      trajectoryPoints.push({x: centerX + xRel, y: centerY + yRel});
      if (trajectoryPoints.length > maxPoints) {
        trajectoryPoints.shift(); // удаляем старые точки, чтобы не перегружать
      }

      // Рисуем траекторию
      ctx.strokeStyle = 'orange';
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (let i = 0; i < trajectoryPoints.length; i++) {
        const p = trajectoryPoints[i];
        if (i === 0) {
          ctx.moveTo(p.x, p.y);
        } else {
          ctx.lineTo(p.x, p.y);
        }
      }
      ctx.stroke();

      // Рисуем Землю (центр системы)
      drawPlanet(xE, yE, 8, 'blue', 'Земля');

      // Рисуем Меркурий
      drawPlanet(xM, yM, 5, 'orange', 'Меркурий');

      // Рисуем центр - точку отсчёта (Земля в системе отсчёта)
      ctx.fillStyle = 'blue';
      ctx.beginPath();
      ctx.arc(centerX, centerY, 6, 0, 2 * Math.PI);
      ctx.fill();

      // Подписи
      ctx.fillStyle = 'black';
      ctx.font = '16px Arial';
      ctx.fillText('Текущий день: ' + t.toFixed(1), 10, height - 20);

      t += dt;
      if (t > 365 * 3) { // через 3 года сбрасываем
        t = 0;
        trajectoryPoints = [];
      }

      requestAnimationFrame(animate);
    }

    // Обработчик переключения радиокнопок
    document.getElementById('controls').addEventListener('change', () => {
      updateOmegaM();
      t = 0;
      trajectoryPoints = [];
    });

    // Инициализация
    updateOmegaM();
    animate();
  </script>
</body>
</html>
