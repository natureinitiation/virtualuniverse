<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Анкета и диагностика темперамента">
  <title>Самоанализ</title>
      <link rel="manifest" href="manifest.json"> <!-- Ссылка на манифест -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .select-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px; /* Равномерные отступы между группами */
    margin: 10px 0;
  }
  
  .select-group {
    display: inline-block;
    min-width: 160px; /* Минимальная ширина для выравнивания */
  }
  
  .select-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }
  
  select, button {
    background: #000;
    color: #fff;
    border: 1px solid #fff;
    padding: 10px;
    margin: 5px 0; /* Единые отступы сверху/снизу */
    font-size: 14px;
    width: 100%; /* Растягиваем на всю ширину родителя */
  }
  
  .buttons {
    margin: 10px 0;
  }
button {
      background: #444; /* Серый фон */
      color: #fff;
      border: 0px solid #888; /* Серая рамка */
      padding: 10px 15px;
      margin-right: 10px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 0; /* Убираем скругление углов */
    }
    button:hover {
      background: #444; /* Темнее при наведении */
    }
    table {
      border-collapse: collapse;
      margin-top: 20px;
    }
    td, th {
      border: 1px solid #888;
      padding: 6px 10px;
      text-align: center;
    }
    canvas {
      max-width: 100%;
      height: 400px;
    }
    .category-header {
      font-weight: bold;
      text-align: left !important;
    }
 :root {
      --emotion-color: #ff5252;
      --energy-color: #ff9800;
      --focus-color: #ffeb3b;
      --creativity-color: #00ff00;
      --vision-color: #0000ff;
      --hearing-color: #9c27b0;
      --smell-color: #00bcd4;
    }

    /* Стили для select с цветными рамками */
    #emotion {
      border: 1px solid var(--emotion-color);
    }
    #energy {
      border: 1px solid var(--energy-color);
    }
    #focus {
      border: 1px solid var(--focus-color);
    }
    #creativity {
      border: 1px solid var(--creativity-color);
    }
    #vision {
      border: 1px solid var(--vision-color);
    }
    #hearing {
      border: 1px solid var(--hearing-color);
    }
    #smell {
      border: 1px solid var(--smell-color);
    }

    /* При наведении делаем рамку ярче */
    select:hover {
      filter: brightness(1.2);
    }
 /* Добавленные отступы */
    
  .select-container {
    margin-bottom: 50px;
    gap: 15px;
  }
  .select-group {
    margin-top: 30px;

    gap: 15px;
  }
  
  table {
    margin: 50px 0;
  }
  
  @media (max-width: 768px) {
    .select-group {
      margin-bottom: 10px;
      width: 100%;
    }
  }
  </style>
</head>
<body>

<h2>Самоанализ</h2>

<div>
  <button onclick="save()">Сохранить</button>
  <button onclick="load()">Загрузить</button>
</div>

<div>
<div class="select-container">

  <div class="select-group">
    <label for="emotion" style="color: #ffffff;">Эмоции</label>
    <select id="emotion" onchange="log('emotion')">
      <option selected disabled>Выберите значение</option>
      <option value="1">Тревога</option>
      <option value="2">Нейтрально</option>
      <option value="3">Спокойствие</option>
      <option value="4">Радость</option>
      <option value="5">Гармония</option>
    </select>
  </div>

  <div class="select-group">
    <label for="energy" style="color: #ffffff;">Энергия</label>
    <select id="energy" onchange="log('energy')">
      <option selected disabled>Выберите значение</option>
      <option value="1">Усталость</option>
      <option value="2">Низкая</option>
      <option value="3">Средняя</option>
      <option value="4">Высокая</option>
      <option value="5">Пик</option>
    </select>
  </div>

  <div class="select-group">
    <label for="focus" style="color: #ffffff;">Фокус</label>
    <select id="focus" onchange="log('focus')">
      <option selected disabled>Выберите значение</option>
      <option value="1">Рассеян</option>
      <option value="2">Периодический</option>
      <option value="3">Умеренный</option>
      <option value="4">Сильный</option>
      <option value="5">Полный</option>
    </select>
  </div>

  <div class="select-group">
    <label for="creativity" style="color: #ffffff;">Творчество</label>
    <select id="creativity" onchange="log('creativity')">
      <option selected disabled>Выберите значение</option>
      <option value="1">Блок</option>
      <option value="2">Редко</option>
      <option value="3">Умеренно</option>
      <option value="4">Активно</option>
      <option value="5">Поток</option>
    </select>
  </div>

  <div class="select-group">
    <label for="vision" style="color: #ffffff;">Зрение</label>
    <select id="vision" onchange="log('vision')">
      <option selected disabled>Выберите значение</option>
      <option value="1">Затуманено</option>
      <option value="2">Снижение</option>
      <option value="3">Норма</option>
      <option value="4">Чётко</option>
      <option value="5">Очень остро</option>
    </select>
  </div>

  <div class="select-group">
    <label for="hearing" style="color: #ffffff;">Слух</label>
    <select id="hearing" onchange="log('hearing')">
      <option selected disabled>Выберите значение</option>
      <option value="1">Приглушён</option>
      <option value="2">Слабый</option>
      <option value="3">Норма</option>
      <option value="4">Повышен</option>
      <option value="5">Очень острый</option>
    </select>
  </div>

  <div class="select-group">
    <label for="smell" style="color: #ffffff;">Обоняние</label>
    <select id="smell" onchange="log('smell')">
      <option selected disabled>Выберите значение</option>
      <option value="1">Отсутствует</option>
      <option value="2">Слабое</option>
      <option value="3">Норма</option>
      <option value="4">Яркое</option>
      <option value="5">Очень чувствительное</option>
    </select>
  </div>
</div>
</div>




<table id="table">
  
</table>

<div class="chart-container">
  <canvas id="chart"></canvas>
</div>

<script>
  const rows = ['emotion', 'energy', 'focus', 'creativity', 'vision', 'hearing', 'smell'];
  const colors = {
    emotion: '#ff5252',
    energy: '#ff9800',
    focus: '#ffeb3b',
    creativity: '#00ff00',
    vision: '#0000ff',
    hearing: '#9c27b0',
    smell: '#00bcd4'
  };
  
  const categoryNames = {
    emotion: 'Эмоции',
    energy: 'Энергия',
    focus: 'Фокус',
    creativity: 'Творчество',
    vision: 'Зрение',
    hearing: 'Слух',
    smell: 'Обоняние'
  };

  const table = document.getElementById('table');
  
  // Инициализация таблицы с заголовками категорий
  rows.forEach(key => {
    const row = table.insertRow(-1);
    const cell = row.insertCell(0);
    cell.textContent = categoryNames[key];
    cell.className = 'category-header';
    cell.style.color = colors[key];
  });

  const chart = new Chart(document.getElementById('chart').getContext('2d'), {
    type: 'line',
    data: {
      labels: [],
      datasets: rows.map(key => ({
        label: '',
        data: [],
        borderColor: colors[key],
        borderWidth: 1,
        fill: false,
        tension: 0.1
      }))
    },
    options: {
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        y: {
min: 0.5,
        max: 5.5,
        grace: '10%', // Автоматический отступ
          ticks: {
          stepSize: 1, // Шаг сетки

            callback: v => Number.isInteger(v) ? v : ''
          },
         
        }
      }
    }
  });

  function log(key) {
  const val = +document.getElementById(key).value;
  const col = chart.data.labels.length;
  const rowIndex = rows.indexOf(key);

  chart.data.labels.push(col + 1);
  rows.forEach(r => {
    const dataset = chart.data.datasets.find(d => d.borderColor === colors[r]);
    dataset.data.push(r === key ? val : (dataset.data[col - 1] ?? null));
    
    const row = table.rows[rows.indexOf(r)];
    const cell = row.insertCell(-1);
    cell.textContent = r === key ? val : '';
    
    // Цвет цифр в зависимости от значения
    if (val) {
      if (val === 1) cell.style.color = '#ff0000'; // красный
      else if (val === 2) cell.style.color = '#ff9800'; // оранжевый
      else if (val === 3) cell.style.color = '#ffeb3b'; // жёлтый
      else if (val === 4) cell.style.color = '#00ff00'; // зелёный
      else if (val === 5) cell.style.color = '#0000ff'; // синий
    }
  });

  chart.update();
}

  function save() {
    const payload = {
      labels: chart.data.labels,
      datasets: chart.data.datasets.map(d => d.data)
    };
    const blob = new Blob([JSON.stringify(payload)], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'self_state.json';
    a.click();
  }

  function load() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = e => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      const parsed = JSON.parse(reader.result);
      chart.data.labels = parsed.labels;
      parsed.datasets.forEach((d, i) => {
        chart.data.datasets[i].data = d;
      });

      // Очистка таблицы (кроме первого столбца)
      rows.forEach(r => {
        const row = table.rows[rows.indexOf(r)];
        while (row.cells.length > 1) row.deleteCell(-1);
      });

      // Заполнение данных
      // В функции load(), внутри обработчика reader.onload
parsed.datasets[0].forEach((_, step) => {
  rows.forEach(r => {
    const v = parsed.datasets[rows.indexOf(r)][step];
    const row = table.rows[rows.indexOf(r)];
    const cell = row.insertCell(-1);
    cell.textContent = Number.isFinite(v) ? v : '';
    
    // Цвет цифр в зависимости от значения
    if (v) {
      if (v === 1) cell.style.color = '#ff0000';
      else if (v === 2) cell.style.color = '#ff9800';
      else if (v === 3) cell.style.color = '#ffeb3b';
      else if (v === 4) cell.style.color = '#4caf50';
      else if (v === 5) cell.style.color = '#2196f3';
    }
  });
});

      chart.update();
    };
    reader.readAsText(file);
  };
  input.click();
}
</script>

</body>
</html>
