<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QWERTY –≤ –Ø–®–ï–†–¢–´</title>
    <style>
        /* --- –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò --- */
        body {
            font-family: Arial, sans-serif;
            margin-top: 30px;
            margin-bottom: 30px;
            background-color: #121212;
            color: #e0e0e0;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #1e1e1e;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }
        h1 {
            color: #bb86fc;
            border-bottom: 2px solid #bb86fc;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        textarea {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #333;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
            resize: vertical;
            background-color: #2c2c2c;
            color: #e0e0e0;
            min-height: 80px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        /* --- –°–ö–†–´–í–ê–ï–ú –ê–ö–¢–ò–í–ù–û–ï –ü–û–õ–ï –í–í–û–î–ê --- */
        #latinInput {
            opacity: 0; 
            height: 0;
            padding: 0;
            margin-bottom: 0;
            border: none;
            overflow: hidden;
            resize: none;
        }
        /* --- –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—è (–¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞) --- */
        #cyrillicOutput {
            min-height: 120px;
            cursor: default;
        }
        .copy-button {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #03dac6;
            color: #121212;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 5px;
            display: block;
            width: 100%;
        }
        .copy-button:hover {
            background-color: #039c8c;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥–≤–∞–ª–∞ (—Å—Å—ã–ª–∫–∏) */
        .page-footer {
            max-width: 800px;
            margin: 20px auto 0;
            padding: 0 30px;
        }
        .page-footer a {
            color: #bb86fc;
            text-decoration: none;
            font-size: 14px;
        }
        .page-footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>QWERTY –≤ –Ø–®–ï–†–¢–´</h1>
    <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –ª–∞—Ç–∏–Ω—Å–∫–∏—Ö –±—É–∫–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö (–≤–∫–ª—é—á–∞—è —É–∫—Ä–∞–∏–Ω—Å–∫–∏–µ): ZH –¥–ª—è –ñ, CH ‚Äî –ß, SH ‚Äî –®, SHH, SCH –∏–ª–∏ CSH ‚Äî –©, E ‚Äî –≠, IE ‚Äî –Ñ, YE ‚Äî –ï, YO ‚Äî –Å, YU ‚Äî –Æ, IE ‚Äî –ï, YA ‚Äî –Ø, CZ –∏–ª–∏ TS ‚Äî –¶, II ‚Äî I, YI ‚Äî –á, ''' ‚Äî –™, '' ‚Äî –¨, --- –¥–ª–∏–Ω–Ω–æ–µ —Ç–∏—Ä–µ, -- –º–∏–Ω—É—Å</p>
    
    <label for="cyrillicOutput">–í–∞—à –¢–µ–∫—Å—Ç:</label>
    <textarea id="cyrillicOutput" rows="6" readonly placeholder="–¢–µ–∫—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..."></textarea>
    
    <button id="copyButton" class="copy-button">
        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ö–∏—Ä–∏–ª–ª–∏—Ü—É
    </button>
    
    <label for="latinInput" style="display: none;">–ê–∫—Ç–∏–≤–Ω—ã–π –í–≤–æ–¥ (–°–∫—Ä—ã—Ç):</label>
    <textarea id="latinInput" rows="2" placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å"></textarea>

</div>

<div class="page-footer">
    <a href="https://eqlectika.t.me/" target="_blank">
        @eqlectika
    </a>
</div>

<script>
    // 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –°–ª–æ–≤–∞—Ä—è –ü—Ä–∞–≤–∏–ª –∏ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –†–µ–≥–∏—Å—Ç—Ä–æ–≤
    
    // –ë–ê–ó–û–í–´–ï –ü–†–ê–í–ò–õ–ê –î–õ–Ø –¢–†–ê–ù–°–õ–ò–¢–ï–†–ê–¶–ò–ò (—Å—Ç—Ä–æ—á–Ω—ã–µ)
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–≤—ã—á–Ω—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è: ZH, SH, YU, YO, IE, EE, X, etc.
    const MAPPING_LOWERCASE_BASE = new Map([
        // --- –ú–ù–û–ì–û–°–ò–ú–í–û–õ–¨–ù–´–ï –°–û–ß–ï–¢–ê–ù–ò–Ø (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ —Å–ª–æ–≤–∞—Ä–µ!) ---
        // –ñ, –ß, –®, –©, –¶, –Æ, –Ø, –¨, –™, –≠, –ï, –Å, –ô, –´, –ò
        ['zh', '–∂'], ['ch', '—á'], ['sh', '—à'], ['shh', '—â'], ['csh', '—â'], ['cz', '—Ü'], ['yu', '—é'], 
        ['ya', '—è'], ['yo', '—ë'], ['ie', '—î'], ['ye', '–µ'], ['y', '—ã'], ['ii', '—ñ'],
        ['ts', '—Ü'], ['sch', '—â'], 
        ['e', '—ç'], ['j', '–π'], ['i', '–∏'],
        // –°–æ—á–µ—Ç–∞–Ω–∏—è –¥–ª—è —Ç–≤—ë—Ä–¥–æ–≥–æ –∏ –º—è–≥–∫–æ–≥–æ –∑–Ω–∞–∫–∞ (–∫–∞–∫ –ø—Ä–∏–º–µ—Ä)
        ["'''", '—ä'], ["''", '—å'], ["---", '‚Äî'], ["--", '‚Äì'],
        // –£–∫—Ä–∞–∏–Ω—Å–∫–∏–µ/–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–µ (–∫–∞–∫ –ø—Ä–∏–º–µ—Ä)
        ['yi', '—ó'], 
        
        // --- –û–î–ò–ù–û–ß–ù–´–ï –ë–£–ö–í–´ (QWERTY -> –ö–∏—Ä–∏–ª–ª–∏—Ü–∞) ---
        ['a', '–∞'], ['b', '–±'], ['v', '–≤'], ['g', '–≥'], ['d', '–¥'], 
        ['k', '–∫'], ['l', '–ª'], ['m', '–º'], ['n', '–Ω'], ['o', '–æ'], 
        ['p', '–ø'], ['r', '—Ä'], ['s', '—Å'], ['t', '—Ç'],
        ['u', '—É'], ['f', '—Ñ'], ['x', '—Ö'], ['z', '–∑'], 
    ]);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö 2^N –≤–∞—Ä–∏–∞—Ü–∏–π —Ä–µ–≥–∏—Å—Ç—Ä–∞ –¥–ª—è –º–Ω–æ–≥–æ–±—É–∫–≤–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π
    // (–û—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞ - SH/sh -> –®/—à)
    function generateCaseVariations(str, cyr) {
        const variations = new Map();
        const len = str.length;
        const numVariations = 1 << len;
        
        for (let i = 0; i < numVariations; i++) {
            let variation = '';
            let isAllUpper = true;
            
            for (let j = 0; j < len; j++) {
                if ((i >> j) & 1) {
                    variation += str[j].toUpperCase();
                } else {
                    variation += str[j];
                    isAllUpper = false;
                }
            }
            
            let cyrOutput = cyr;

            // –ï—Å–ª–∏ –ª–∞—Ç–∏–Ω—Å–∫–∏–π –≤–≤–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥–ª–∞–≤–Ω—ã–π (SH, ZH, YU), 
            // –º—ã –¥–µ–ª–∞–µ–º –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–π —Å–∏–º–≤–æ–ª –∑–∞–≥–ª–∞–≤–Ω—ã–º.
            if (isAllUpper) {
                cyrOutput = cyr.toLocaleUpperCase('ru'); 
            }
            
            variations.set(variation, cyrOutput);
        }
        return variations;
    }
    
    const MAPPING = new Map();

    // 1. –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –±—É–∫–≤–∞–º–∏ –∏–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º–∏ (–ü—É–Ω–∫—Ç., –¶–∏—Ñ—Ä—ã)
    const NON_ALPHABET_CHARS = new Map([
        [' ', ' '], ['.', '.'], [',', ','], ['!', '!'], ['?', '?'],
        ['0', '0'], ['1', '1'], ['2', '2'], ['3', '3'], ['4', '4'],
        ['5', '5'], ['6', '6'], ['7', '7'], ['8', '8'], ['9', '9'],
    ]);
    for (const [lat, cyr] of NON_ALPHABET_CHARS) {
         MAPPING.set(lat, cyr);
    }
    

    // 2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±—É–∫–≤—ã –∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
    for (const [lat, cyr] of MAPPING_LOWERCASE_BASE) {
        if (lat.length > 1) {
            // –ú–ù–û–ì–û–ë–£–ö–í–ï–ù–ù–ê–Ø –ö–û–ú–ë–ò–ù–ê–¶–ò–Ø (sh, zh, yu)
            const variations = generateCaseVariations(lat, cyr);
            for (const [v, c] of variations) {
                 MAPPING.set(v, c);
            }
        } else {
            // –û–î–ò–ù–û–ß–ù–ê–Ø –ë–£–ö–í–ê (a, b, t)
            
            // –°—Ç—Ä–æ—á–Ω–∞—è
            MAPPING.set(lat, cyr);
            
            // –ó–∞–≥–ª–∞–≤–Ω–∞—è (–µ—Å–ª–∏ —ç—Ç–æ –±—É–∫–≤–∞)
            if (lat.match(/[a-z]/i)) {
                MAPPING.set(lat.toUpperCase(), cyr.toUpperCase());
            }
        }
    }
    
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–ª–∏–Ω–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–∞–º–æ–≥–æ –¥–ª–∏–Ω–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (–ö–†–ò–¢–ò–ß–ù–û –¥–ª—è 'shh' > 'sh')
    const sorted_keys = Array.from(MAPPING.keys()).sort((a, b) => b.length - a.length);


    // 2. –§—É–Ω–∫—Ü–∏—è –¢—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏–∏
    function transcodeToCyrillic(lat_text) {
        if (!lat_text) return '';

        let output = [];
        let i = 0;
        const text = lat_text;
        const len = text.length;

        while (i < len) {
            let foundMatch = false;
            
            for (const lat_key of sorted_keys) {
                const key_len = lat_key.length;
                const fragment = text.substring(i, i + key_len);

                if (fragment === lat_key) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∞–ø–ø–∏–Ω–≥, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—ã–π —Ä–µ–≥–∏—Å—Ç—Ä
                    const cyr_char = MAPPING.get(lat_key);
                    
                    output.push(cyr_char);
                    i += key_len;
                    foundMatch = true;
                    break;
                }
            }
            
            if (!foundMatch) {
                // –ï—Å–ª–∏ —Å–∏–º–≤–æ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –∫–∞–∫ –µ—Å—Ç—å 
                output.push(text[i]);
                i++;
            }
        }
        
        return output.join('');
    }


    // 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –í–≤–æ–¥–æ–º (–£–ü–†–û–©–ï–ù–ù–´–ô –í–í–û–î –ë–ï–ó –ü–ê–£–ó)
    const latinInput = document.getElementById('latinInput');
    const cyrillicOutput = document.getElementById('cyrillicOutput');
    const copyButton = document.getElementById('copyButton'); 

    // –í —É–ø—Ä–æ—â–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ –Ω–∞–º –Ω–µ –Ω—É–∂–Ω—ã: 
    // DELAY_MS, finalizedCyrillicText, lastKeyPressTime, FINALIZE_KEYS, finalizeInput,
    // –∏ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ keydown.
    
    // –ù–æ–≤—É—é –ª–æ–≥–∏–∫—É –≤–≤–æ–¥–∏–º —á–µ—Ä–µ–∑ 'input' –∏ 'keydown' –¥–ª—è Backspace.

    // 3.1. –û–ë–†–ê–ë–û–¢–ß–ò–ö KEYDOWN: –¢–æ–ª—å–∫–æ –¥–ª—è Backspace
    latinInput.addEventListener('keydown', function(event) {
        // –ú—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–ª–∞–≥–∞–µ–º—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥ –≤ latinInput –∏ –ø–µ—Ä–µ–∫–æ–¥–∏—Ä—É–µ–º –µ–≥–æ –≤ 'input'
        if (event.key === 'Backspace') {
            // –†–∞–∑—Ä–µ—à–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π backspace.
            return; 
        }

        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–ø–µ—Ü–∫–ª–∞–≤–∏—à–∏, –Ω–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ–±–µ–ª –∏ Enter
        if (event.key.length > 1 && event.key !== ' ' && event.key !== 'Enter') {
            return;
        }

        // –ú—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–∏–∫–∞–∫–∏—Ö –ø–∞—É–∑ –∏–ª–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏, 
        // –ø—Ä–æ—Å—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ–º –≤–≤–æ–¥—É –∏–¥—Ç–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –µ–≥–æ –≤ 'input'
    });

    // 3.2. –°–ª—É—à–∞—Ç–µ–ª—å INPUT: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ü–†–ï–î–ü–†–û–°–ú–û–¢–†–ê (—Ç–µ–ø–µ—Ä—å —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≤—ã–≤–æ–¥–∞)
    latinInput.addEventListener('input', function() {
        const currentDecodedPreview = transcodeToCyrillic(latinInput.value);
        // cyrillicOutput —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ latinInput
        cyrillicOutput.value = currentDecodedPreview;
    });
    
    // 3.3. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Ñ–æ–∫—É—Å
    document.addEventListener('click', function() {
        latinInput.focus();
    });
    document.addEventListener('touchstart', function() {
        latinInput.focus();
    });
    
    // 4. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ö–Ω–æ–ø–∫–∏ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
    copyButton.addEventListener('click', function() {
        // –í —É–ø—Ä–æ—â—ë–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ cyrillicOutput
        const textToCopy = cyrillicOutput.value; 
        
        if (navigator.clipboard && textToCopy) {
            navigator.clipboard.writeText(textToCopy).then(() => {
                copyButton.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                setTimeout(() => {
                    copyButton.textContent = 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ö–∏—Ä–∏–ª–ª–∏—Ü—É';
                }, 1500); 
            }).catch(err => {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é.');
            });
        } else {
            alert('–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.');
        }
        latinInput.focus();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —Å—Ç–∞–≤–∏–º —Ñ–æ–∫—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    latinInput.focus(); 
</script>


</body>
</html>
